# 대시보드_시나리오

> **대상:** HandsDB 시스템 운영자 / DB 관리자  
> **목적:** 대시보드 화면의 기능과 사용 시나리오를 정의합니다.  
> **최종 수정일:** 2026-02-08

---

## 1. 화면 개요

대시보드는 HandsDB의 **메인 현황판**으로, 등록된 서버와 DB의 전체 상태를 한눈에 파악할 수 있는 화면입니다.

### 화면 구성

| 영역 | 설명 |
|------|------|
| 서버 선택 | 상단 서버 콤보박스로 전체/개별 서버 전환 |
| 탭 메뉴 | 현황 / 서버 점검 / DB 점검 (3개 탭) |
| 요약 카드 | 핵심 지표 4개 (DB 수, 총 용량, 경고, 오류) |
| DB별 용량 차트 | 검색/정렬 가능한 DB 용량 막대 그래프 + 디스크 사용률 |
| 최근 작업 이력 | 작업 유형별 필터 + 상대 시간 표시 |
| 서버별 현황 | 전체 모드에서 서버 목록 + 비동기 연결 상태 체크 |

### 화면 URL

| URL | 설명 |
|-----|------|
| `/dashboard` | 전체 서버 통합 대시보드 |
| `/dashboard/{server_id}` | 특정 서버 대시보드 |

---

## 2. 시나리오

### 시나리오 2-1: 일일 현황 확인

```
사용자: DB 관리자
목적: 출근 후 전체 시스템 상태 확인

1. 로그인 → 대시보드 자동 이동
2. 요약 카드 확인
   - 전체 DB: 85개
   - 총 용량: 511.1 GB
   - 경고: 0개 / 오류: 0개
3. DB별 용량 차트 확인
   - 용량 큰 순 정렬 (기본값)
   - 상위 DB: NXUNIES_2601123 (116.2 GB)
   - 디스크 사용률 배지 확인: 💽 25.7%
4. 최근 작업 이력 확인
   - "전체" 필터 선택 (기본값)
   - 최근 생성/수정/삭제/백업 이력 확인
   - 상대 시간으로 빠르게 파악 ("3일 전", "1시간 전")
```

### 시나리오 2-2: 특정 서버 상세 확인

```
사용자: DB 관리자
목적: 운영 서버의 DB 용량 상세 확인

1. 상단 서버 콤보박스에서 "운영서버" 선택
2. 페이지가 /dashboard/1 로 전환
3. 요약 카드가 해당 서버 기준으로 갱신
4. DB별 용량 차트에서 검색
   - "ACC" 입력 → ACC_ 접두사 DB만 필터링
   - 정렬: "용량 큰 순" → "이름 순"으로 변경
5. 합계 확인
   - "검색 결과 23개 합계: 245.3 GB"
```

### 시나리오 2-3: 디스크 사용률 확인

```
사용자: DB 관리자
목적: 디스크 여유 공간 확인 (용량 증설 판단)

1. 대시보드 > 서버 선택
2. DB별 용량 차트에서 디스크 배지 확인
   - 💽 34.9% → 정상 (파란색 바)
   - 💽 82.5% → 경고 (주황색 바)
   - 💽 93.1% → 위험 (빨간색 바)
3. 배지에 마우스 올리면 상세 표시
   - "디스크 D:\: 82.5% 사용 (여유: 87GB)"
4. 위험 수준 디스크 발견 시 → 용량 증설 조치

※ 디스크 사용률은 MSSQL, Oracle에서만 표시
  PostgreSQL, MySQL은 OS 레벨 조회 불가 → 배지 미표시
```

### 시나리오 2-4: 작업 이력 필터링

```
사용자: DB 관리자
목적: 최근 삭제 작업 확인

1. 대시보드 > 최근 작업 이력 영역
2. 필터 버튼 확인
   - [전체(30)] [생성(15)] [수정(8)] [삭제(5)] [백업(2)]
   - 괄호 안 숫자: 해당 유형 건수
3. "삭제" 버튼 클릭
   - 삭제 작업만 필터링
   - 각 항목에 휴지통 SVG 아이콘 표시
4. 상대 시간 + 절대 시간 표시
   - "4일 전 · 02-04 18:36"
5. "전체 활동 로그 보기 →" 클릭으로 상세 페이지 이동
```

### 시나리오 2-5: 전체 서버 상태 점검

```
사용자: DB 관리자
목적: 모든 서버의 연결 상태 일괄 확인

1. 대시보드에서 서버 선택 없이 전체 모드 유지
2. "서버별 현황" 테이블 표시
   - 서버명, 호스트:포트, 상태, DB종류, DB수, 경고/오류
3. 상태 열: 비동기 연결 체크 진행
   - ⚪ "확인 중" (로딩 시) → 🟢 "정상" 또는 🔴 "오프라인"
4. 하단 통계: "전체 3개 서버 / 온라인 2 / 오프라인 1"
5. "상태 갱신" 버튼 클릭 → 전체 재체크
6. 오프라인 서버 발견 → "상세" 클릭 → 해당 서버 대시보드로 이동
```

### 시나리오 2-6: 서버 미등록 시

```
사용자: 최초 접속 사용자
목적: 시스템 첫 사용

1. 로그인 후 대시보드 진입
2. 등록된 서버 없음 → 자동으로 /servers 로 리다이렉트
3. 서버 관리 페이지에서 서버 등록
4. 등록 완료 후 대시보드로 이동하면 정상 표시

※ 대시보드 포함 12개 페이지에서 서버 미등록 시 자동 리다이렉트 적용
```

---

## 3. 기능 상세

### 3-1. 요약 카드

| 카드 | 데이터 소스 | 설명 |
|------|------------|------|
| DB 수 | `get_server_databases()` | 서버 내 사용자 DB 수 (시스템 DB 제외) |
| 총 용량 | `size_mb` 합산 | 전체 DB 용량 합계 (GB 단위 표시) |
| 경고 | Corp 테이블 `status=WARNING` | 경고 상태 법인 수 |
| 오류 | Corp 테이블 `status=ERROR` | 오류 상태 법인 수 |

HTMX로 비동기 로드: `GET /partials/dashboard/stats?server_id={id}`

### 3-2. DB별 용량 차트

| 기능 | 설명 |
|------|------|
| 검색 | DB 이름 실시간 필터링 (대소문자 무시) |
| 정렬 | 용량 큰 순 / 용량 작은 순 / 이름 순 / 이름 역순 |
| 비율 바 | 필터링된 목록 내 최대 DB 기준 상대 비율 |
| 디스크 배지 | MSSQL/Oracle: 실제 디스크 사용률 표시 |
| 색상 분기 | 디스크 정보 있을 때: 90%+ 빨강, 80%+ 주황, 나머지 파랑 |
| 합계 | 검색 결과 또는 전체 DB의 용량 합계 |

데이터 소스: `GET /partials/dashboard/capacity-chart/{server_id}?limit=200`

**디스크 사용률 조회 방식 (DB 타입별)**

| DB 타입 | 조회 방법 | 제공 정보 |
|---------|----------|----------|
| MSSQL | `sys.dm_os_volume_stats()` | 디스크 전체/여유 GB, 드라이브명 |
| Oracle | `dba_data_files` + `dba_free_space` | 테이블스페이스 전체/여유 GB |
| PostgreSQL | 직접 조회 불가 | 미표시 |
| MySQL | 직접 조회 불가 | 미표시 |

### 3-3. 최근 작업 이력

| 기능 | 설명 |
|------|------|
| 필터 | 전체 / 생성 / 수정 / 삭제 / 백업 (건수 표시) |
| 동적 필터 | 데이터에 존재하는 유형만 버튼 표시 |
| 아이콘 | SVG 아이콘 (이모지 대신): plus-circle, pencil-square, trash, arrow-down-tray |
| 상대 시간 | "방금 전", "5분 전", "3시간 전", "4일 전", "2주 전" |
| 절대 시간 | "02-04 18:36" (상대 시간과 함께 표시) |
| 상태 표시 | 성공(초록) / 실패(빨강) 배지 |

데이터 소스: `GET /partials/dashboard/activities?server_id={id}&limit=30`

### 3-4. 서버별 현황 (전체 모드)

| 기능 | 설명 |
|------|------|
| 비동기 로드 | `fetch('/api/servers?fast=true')` 로 서버 목록 즉시 표시 |
| 연결 체크 | 각 서버별 `POST /api/servers/{id}/test` 병렬 호출 |
| 상태 인디케이터 | 확인 중(회색 펄스) → 정상(초록) / 오프라인(빨강) |
| 상태 갱신 | 버튼 클릭 시 전체 재체크 |
| 통계 요약 | 전체 N개 서버 / 온라인 N / 오프라인 N |
| 상세 이동 | "상세" 클릭 → `/dashboard/{server_id}` |

---

## 4. 성능 최적화

### 4-1. 비동기 로드 패턴

```
기존 (동기):
  pages.py → get_all_server_summaries() → 모든 서버 연결 테스트 → 응답
  문제: 서버 3개 × 타임아웃 5초 = 최대 15초 대기

개선 (비동기):
  pages.py → 빈 템플릿 즉시 응답
  프론트 → fetch('/api/servers?fast=true') → 서버 목록 즉시 표시
  프론트 → Promise.allSettled(서버별 연결 테스트) → 상태 점진적 갱신
  결과: 초기 로드 < 500ms, 연결 상태는 백그라운드 갱신
```

### 4-2. HTMX + Alpine.js 하이브리드

| 영역 | 로드 방식 | 인터랙션 방식 |
|------|----------|--------------|
| 요약 카드 | HTMX `hx-get` | 없음 (읽기 전용) |
| DB별 용량 | `fetch()` → HTML 파싱 | Alpine.js (검색/정렬) |
| 작업 이력 | `fetch()` → HTML 파싱 | Alpine.js (필터/상대시간) |
| 서버 현황 | `fetch()` → JSON | Alpine.js (연결 상태) |

---

## 5. 관련 파일

### 프론트엔드

| 파일 | 경로 | 설명 |
|------|------|------|
| dashboard.html | `app/templates/pages/` | 대시보드 메인 레이아웃 (탭, 서버 선택) |
| dashboard_overview.html | `app/templates/pages/` | 현황 탭 내용 (요약카드, 용량, 이력, 서버현황) |
| capacity_chart.html | `app/templates/partials/dashboard/` | DB별 용량 막대 그래프 HTML 조각 |
| activities.html | `app/templates/partials/dashboard/` | 최근 활동 이력 HTML 조각 |
| stats.html | `app/templates/partials/dashboard/` | 요약 카드 HTML 조각 |

### 백엔드

| 파일 | 경로 | 설명 |
|------|------|------|
| pages.py | `app/routers/` | 대시보드 페이지 라우터 |
| partials.py | `app/routers/` | HTMX 파셜 라우터 (stats, capacity-chart, activities) |
| server_service.py | `app/services/` | 서버/DB 조회 서비스 |
| mssql.py | `app/services/drivers/` | MSSQL 드라이버 (디스크 사용률 조회) |
| postgresql.py | `app/services/drivers/` | PostgreSQL 드라이버 |
| mysql.py | `app/services/drivers/` | MySQL 드라이버 |
| oracle.py | `app/services/drivers/` | Oracle 드라이버 (테이블스페이스 사용률 조회) |

### API 엔드포인트

| 메서드 | URL | 설명 |
|--------|-----|------|
| GET | `/dashboard` | 대시보드 페이지 |
| GET | `/dashboard/{server_id}` | 서버별 대시보드 |
| GET | `/partials/dashboard/stats` | 요약 카드 데이터 |
| GET | `/partials/dashboard/capacity-chart/{server_id}` | DB별 용량 (디스크 사용률 포함) |
| GET | `/partials/dashboard/activities` | 최근 작업 이력 |
| GET | `/api/servers?fast=true` | 서버 목록 (빠른 조회) |
| POST | `/api/servers/{server_id}/test` | 서버 연결 테스트 |

---

## 6. 시나리오 요약표

| # | 시나리오 | 주요 기능 | 사용 빈도 |
|---|---------|-----------|----------|
| 2-1 | 일일 현황 확인 | 요약 카드, 용량 차트, 작업 이력 | 매일 |
| 2-2 | 특정 서버 상세 확인 | 서버 선택, DB 검색/정렬 | 수시 |
| 2-3 | 디스크 사용률 확인 | 디스크 배지, 색상 경고 | 주간 |
| 2-4 | 작업 이력 필터링 | 유형별 필터, 상대 시간 | 수시 |
| 2-5 | 전체 서버 상태 점검 | 비동기 연결 체크, 상태 갱신 | 매일 |
| 2-6 | 서버 미등록 시 | 자동 리다이렉트 | 최초 1회 |