{% from "components/icons.html" import svg_icon %}

<!-- 3단계: 테이블 초기화 -->
<div class="space-y-6">
    
    <!-- 소스/타겟 DB 설정 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- 소스 (원본) -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4">
                <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                    {{ svg_icon('arrow-up-tray', 'w-5 h-5') }}
                    소스 (원본 DB)
                </h2>
            </div>
            <div class="p-6 space-y-4">
                <!-- 서버 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">서버 *</label>
                    <select id="init-source-server" onchange="loadInitSourceDatabases()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary-500">
                        <option value="">서버 선택</option>
                        {% for server in servers %}
                        <option value="{{ server.id }}">{{ server.server_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- DB -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">DB *</label>
                    <select id="init-source-db" onchange="onInitSourceDbChange()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary-500">
                        <option value="">먼저 서버를 선택하세요</option>
                    </select>
                </div>
                
                <!-- 소스 DB 정보 (법인 정보 대신 간단한 안내) -->
                <div id="init-source-info" class="text-sm text-gray-500">
                    <p>복사할 데이터의 원본 DB를 선택하세요.</p>
                </div>
            </div>
        </div>
        
        <!-- 타겟 (대상) - 다중 선택 -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="bg-gradient-to-r from-green-600 to-green-700 px-6 py-4">
                <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                    {{ svg_icon('arrow-down-tray', 'w-5 h-5') }}
                    타겟 (대상 DB) - 복수 선택
                </h2>
            </div>
            <div class="p-6 space-y-4">
                <!-- 서버 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">서버 *</label>
                    <select id="init-target-server" onchange="loadInitTargetDbList()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary-500">
                        <option value="">서버 선택</option>
                        {% for server in servers %}
                        <option value="{{ server.id }}">{{ server.server_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- DB 목록 (복수 선택) -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-gray-700">DB 선택 *</label>
                        <span id="init-target-count" class="text-xs text-gray-500">선택: 0개</span>
                    </div>
                    
                    <!-- 검색 및 전체선택 -->
                    <div class="flex items-center gap-2 mb-2">
                        <input type="text" id="init-target-search" placeholder="검색..." onkeyup="filterInitTargetList()"
                               class="flex-1 px-3 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:border-primary-500">
                        <label class="flex items-center gap-1 text-sm text-gray-600 cursor-pointer">
                            <input type="checkbox" id="init-select-all" onchange="toggleAllInitTargets(this.checked)" class="rounded">
                            전체
                        </label>
                    </div>
                    
                    <!-- DB 목록 -->
                    <div id="init-target-db-list" class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="p-4 text-center text-gray-400 text-sm">
                            먼저 서버를 선택하세요
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 초기화 옵션 -->
    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
        <h3 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
            {{ svg_icon('adjustments-horizontal', 'w-5 h-5 text-gray-600') }}
            초기화 옵션
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <label class="flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                <input type="checkbox" id="init-opt-truncate" checked class="rounded text-primary-600">
                <div>
                    <div class="font-medium text-sm">기존 데이터 삭제</div>
                    <div class="text-xs text-gray-500">복사 전 TRUNCATE 실행</div>
                </div>
            </label>
            <label class="flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                <input type="checkbox" id="init-opt-replace-corp" checked class="rounded text-primary-600">
                <div>
                    <div class="font-medium text-sm">법인코드 치환</div>
                    <div class="text-xs text-gray-500">CORP_CD 컬럼 값 변경</div>
                </div>
            </label>
            <label class="flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                <input type="checkbox" id="init-opt-keep-identity" class="rounded text-primary-600">
                <div>
                    <div class="font-medium text-sm">Identity 유지</div>
                    <div class="text-xs text-gray-500">IDENTITY_INSERT ON</div>
                </div>
            </label>
        </div>
    </div>
    
    <!-- 테이블 목록 -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="bg-gradient-to-r from-gray-700 to-gray-800 px-6 py-4">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                    {{ svg_icon('table-cells', 'w-5 h-5') }}
                    테이블 목록
                </h2>
                <div class="flex items-center gap-2">
                    <input type="text" id="init-table-search" placeholder="테이블 검색..." 
                           onkeyup="filterInitTables()"
                           class="px-3 py-1.5 text-sm rounded border-0 focus:ring-2 focus:ring-white/50">
                    <span id="init-table-count" class="text-white/70 text-sm">0개</span>
                </div>
            </div>
        </div>
        <div id="init-table-list" class="divide-y divide-gray-100">
            <div class="p-8 text-center text-gray-400">
                소스 DB를 선택하면 테이블 목록이 표시됩니다
            </div>
        </div>
    </div>
    
    <!-- 하단 버튼 -->
    <div class="flex justify-center gap-4">
        <button type="button" onclick="goToStep2FromStep3()"
                class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition flex items-center gap-2">
            {{ svg_icon('arrow-left', 'w-5 h-5') }}
            이전
        </button>
        <a href="/db/list" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
            완료
        </a>
    </div>
</div>

<!-- 초기화 결과 모달 -->
<div id="init-result-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden">
        <div id="init-result-content" class="overflow-y-auto max-h-[80vh]"></div>
    </div>
</div>