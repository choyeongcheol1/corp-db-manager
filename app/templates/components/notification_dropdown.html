{# 
알림 드롭다운 컴포넌트
#}

<div class="w-80 max-h-[28rem] overflow-hidden flex flex-col bg-white rounded-xl shadow-xl border border-gray-200">
    <!-- 헤더 -->
    <div class="px-4 py-3 border-b border-gray-100 flex items-center justify-between bg-gray-50 flex-shrink-0">
        <div class="flex items-center gap-2">
            <span class="font-semibold text-gray-800">알림</span>
            {% if unread_count > 0 %}
            <span class="px-2 py-0.5 bg-red-500 text-white text-xs rounded-full">{{ unread_count }}</span>
            {% endif %}
        </div>
        {% if notifications and unread_count > 0 %}
        <button hx-post="/notifications/read-all"
                hx-target="#notification-content"
                hx-swap="innerHTML"
                class="text-xs text-primary-600 hover:text-primary-800 font-medium">
            모두 읽음
        </button>
        {% endif %}
    </div>
    
    <!-- 알림 목록 -->
    <div class="overflow-y-auto flex-1" id="notification-list">
        {% if notifications %}
            {% for noti in notifications %}
            <div class="px-4 py-3 hover:bg-gray-50 border-b border-gray-50 transition-colors cursor-pointer {{ 'bg-blue-50/50' if not noti.is_read else '' }}"
                 {% if noti.link %}
                 hx-post="/notifications/{{ noti.id }}/read"
                 hx-target="#notification-content"
                 hx-swap="innerHTML"
                 onclick="setTimeout(() => window.location.href='{{ noti.link }}', 100)"
                 {% else %}
                 hx-post="/notifications/{{ noti.id }}/read"
                 hx-target="#notification-content"
                 hx-swap="innerHTML"
                 {% endif %}>
                <div class="flex items-start gap-3">
                    <!-- 아이콘 -->
                    <div class="flex-shrink-0 mt-0.5">
                        {% if noti.type == 'error' %}
                        <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center">
                            <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="15" y1="9" x2="9" y2="15"/>
                                <line x1="9" y1="9" x2="15" y2="15"/>
                            </svg>
                        </div>
                        {% elif noti.type == 'warning' %}
                        <div class="w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center">
                            <svg class="w-4 h-4 text-amber-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                        </div>
                        {% elif noti.type == 'success' %}
                        <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center">
                            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                        </div>
                        {% else %}
                        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="16" x2="12" y2="12"/>
                                <line x1="12" y1="8" x2="12.01" y2="8"/>
                            </svg>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- 내용 -->
                    <div class="flex-1 min-w-0">
                        <p class="text-sm text-gray-800 {{ 'font-semibold' if not noti.is_read else 'font-medium' }} truncate">
                            {{ noti.title }}
                        </p>
                        {% if noti.message %}
                        <p class="text-xs text-gray-500 mt-0.5 line-clamp-2">
                            {{ noti.message }}
                        </p>
                        {% endif %}
                        <p class="text-xs text-gray-400 mt-1">
                            {{ noti.time_ago }}
                        </p>
                    </div>
                    
                    <!-- 읽지 않음 표시 -->
                    {% if not noti.is_read %}
                    <div class="flex-shrink-0 mt-2">
                        <span class="w-2 h-2 bg-primary-500 rounded-full block"></span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <!-- 알림 없음 -->
            <div class="px-4 py-12 text-center">
                <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-gray-100 flex items-center justify-center">
                    <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                    </svg>
                </div>
                <p class="text-sm text-gray-500">새로운 알림이 없습니다</p>
            </div>
        {% endif %}
    </div>
    
    <!-- 푸터 -->
    {% if notifications %}
    <div class="px-4 py-2.5 border-t border-gray-100 bg-gray-50 flex-shrink-0">
        <a href="/notifications/all" class="block text-center text-sm text-primary-600 hover:text-primary-800 font-medium">
            전체 알림 보기
        </a>
    </div>
    {% endif %}
</div>